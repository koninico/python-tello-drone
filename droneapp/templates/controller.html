{% extends "layout.html" %} {% block content %}

<style>
  .controller-box {
    text-align: center;
    margin: 20px 0;
  }

  .control-grid {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    margin: 30px 0;
    gap: 40px;
  }

  .control-section {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .control-section h3 {
    margin-bottom: 15px;
    color: #333;
    font-size: 1.1em;
    text-align: center;
  }

  .button-grid {
    display: grid;
    gap: 10px;
    justify-items: center;
  }

  .altitude-controls {
    grid-template-columns: repeat(3, 50px);
    grid-template-rows: repeat(3, 50px);
  }

  .movement-controls {
    grid-template-columns: repeat(3, 50px);
    grid-template-rows: repeat(3, 50px);
  }

  .altitude-controls .up {
    grid-column: 2;
    grid-row: 1;
  }
  .altitude-controls .clockwise {
    grid-column: 3;
    grid-row: 2;
  }
  .altitude-controls .counter-clockwise {
    grid-column: 1;
    grid-row: 2;
  }
  .altitude-controls .down {
    grid-column: 2;
    grid-row: 3;
  }

  .movement-controls .forward {
    grid-column: 2;
    grid-row: 1;
  }
  .movement-controls .left {
    grid-column: 1;
    grid-row: 2;
  }
  .movement-controls .right {
    grid-column: 3;
    grid-row: 2;
  }
  .movement-controls .back {
    grid-column: 2;
    grid-row: 3;
  }

  .section-title {
    text-align: center;
    margin-bottom: 10px;
    position: relative;
    z-index: 1;
  }

  /* FlipとADVANCED MODEセクションの上下余白 */
  .flip-section {
    margin-top: 20px;
    margin-bottom: 20px;
  }

  .advanced-section {
    margin-top: 30px;
    margin-bottom: 20px;
  }

  /* Speedセクションの余白調整 */
  .speed-section h3 {
    margin-top: 5px !important;
    margin-bottom: 2px !important; /* タイトルとスライダーの間隔を狭く */
  }

  .speed-section input[type="range"] {
    margin-top: 2px; /* スライダーの上部余白を調整 */
    margin-bottom: 5px; /* スライダーの下部余白を調整 */
  }
</style>

<script>
  // コマンド送信
  function sendCommand(command, params = {}) {
    console.log({ action: "sendCommand", command: command, params: params });
    params["command"] = command;
    $.post("/api/command/", params).done(function (json) {
      console.log({ action: "sendCommand", json: json });
    }, "json");
  }

  // スナップショット取得
  function snapShot() {
    $.post("/api/command/", { command: "snapshot" }).done(function (json) {
      $("#div-snapshot").show();
      // キャッシュを避けるためにランダムパラメータを追加
      $("#snapshot").attr(
        "src",
        "/static/img/snapshots/snapshot.jpg?" + Math.random()
      );
    }, "json");
  }

  // スピードスライダーのイベントハンドラ
  $(document).on("pageinit", function () {
    $("#slider-speed").on("slidestop", function (event) {
      let params = {
        speed: $("#slider-speed").val(),
      };
      sendCommand("speed", params);
    });
  });
</script>

<div class="controller-box">
  <h1>Remote Controller</h1>
</div>

<!-- 離陸・着陸コントロール -->
<div class="controller-box">
  <div data-role="controlgroup" data-type="horizontal">
    <a
      href="#"
      data-role="button"
      onClick="sendCommand('takeoff'); return false;"
      >Take Off</a
    >
    <a href="#" data-role="button" onClick="sendCommand('land'); return false;"
      >Land</a
    >
  </div>
</div>

<!-- ドローンコントロール -->
<div class="control-grid">
  <!-- 高度・回転コントロール -->
  <div class="control-section">
    <h3>高度・回転</h3>
    <div class="button-grid altitude-controls">
      <div class="ui-nodisc-icon ui-alt-icon up">
        <a
          href="#"
          class="ui-btn ui-shadow ui-corner-all ui-icon-carat-u ui-btn-icon-notext ui-btn-inline"
          onClick="sendCommand('up'); return false;"
          title="上昇"
        ></a>
      </div>

      <div class="ui-nodisc-icon ui-alt-icon counter-clockwise">
        <a
          href="#"
          class="ui-btn ui-shadow ui-corner-all ui-icon-recycle ui-btn-icon-notext ui-btn-inline"
          onClick="sendCommand('counter_clockwise'); return false;"
          title="反時計回り"
        ></a>
      </div>

      <div class="ui-nodisc-icon ui-alt-icon clockwise">
        <a
          href="#"
          class="ui-btn ui-shadow ui-corner-all ui-icon-refresh ui-btn-icon-notext ui-btn-inline"
          onClick="sendCommand('clockwise'); return false;"
          title="時計回り"
        ></a>
      </div>

      <div class="ui-nodisc-icon ui-alt-icon down">
        <a
          href="#"
          class="ui-btn ui-shadow ui-corner-all ui-icon-carat-d ui-btn-icon-notext ui-btn-inline"
          onClick="sendCommand('down'); return false;"
          title="下降"
        ></a>
      </div>
    </div>
  </div>

  <!-- 移動コントロール -->
  <div class="control-section">
    <h3>移動</h3>
    <div class="button-grid movement-controls">
      <div class="ui-nodisc-icon ui-alt-icon forward">
        <a
          href="#"
          class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-u ui-btn-icon-notext ui-btn-inline"
          onClick="sendCommand('forward'); return false;"
          title="前進"
        ></a>
      </div>

      <div class="ui-nodisc-icon ui-alt-icon left">
        <a
          href="#"
          class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-notext ui-btn-inline"
          onClick="sendCommand('left'); return false;"
          title="左移動"
        ></a>
      </div>

      <div class="ui-nodisc-icon ui-alt-icon right">
        <a
          href="#"
          class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-r ui-btn-icon-notext ui-btn-inline"
          onClick="sendCommand('right'); return false;"
          title="右移動"
        ></a>
      </div>

      <div class="ui-nodisc-icon ui-alt-icon back">
        <a
          href="#"
          class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-d ui-btn-icon-notext ui-btn-inline"
          onClick="sendCommand('back'); return false;"
          title="後退"
        ></a>
      </div>
    </div>
  </div>
</div>

<div class="controller-box">
  <h3>Speed</h3>
      <input
    type="range"
    name="slider-2"
    id="slider-speed"
    data-highlight="true"
    min="0"
    max="100"
    value="10"
  />
</div>

<div class="controller-box flip-section">
  <h3>Flip</h3>
  <div data-role="controlgroup" data-type="horizontal">
    <a
      href="#"
      data-role="button"
      data-inline="true"
      onclick="sendCommand('flipFront'); return false;"
      >Forward</a
    >
    <a
      href="#"
      data-role="button"
      data-inline="true"
      onclick="sendCommand('flipLeft'); return false;"
      >Left</a
    >
    <a
      href="#"
      data-role="button"
      data-inline="true"
      onclick="sendCommand('flipRight'); return false;"
      >Right</a
    >
    <a
      href="#"
      data-role="button"
      data-inline="true"
      onclick="sendCommand('flipBack'); return false;"
      >Back</a
    >
  </div>
</div>

<div class="controller-box advanced-section">
  <h3>ADVANCED MODE</h3>
  <div data-role="controlgroup" data-type="horizontal">
    <a
      href="#"
      data-role="button"
      data-inline="true"
      onclick="sendCommand('patrol'); return false;"
      >Patrol</a
    >
    <a
      href="#"
      data-role="button"
      data-inline="true"
      onclick="sendCommand('stopPatrol'); return false;"
      >Stop Patrol</a
    >
    <a
      href="#"
      data-role="button"
      data-inline="true"
      onclick="sendCommand('faceDetectAndTrack'); return false;"
      >Face Detect and Track</a
    >
    <a
      href="#"
      data-role="button"
      data-inline="true"
      onclick="sendCommand('stopFaceDetectAndTrack'); return false;"
      >Stop Face Detect and Track</a
    >
  </div>
  <br />
  <img src="/video/streaming" />
</div>

<div class="controller-box advanced-section">
  <h3>CAMERA</h3>
  <a
    href="#"
    data-role="button"
    data-inline="true"
    onclick="snapShot(); return false;"
    >Snapshot</a
  >
  <div id="div-snapshot" style="display: none">
    <img id="snapshot" src="/static/img/snapshots/snapshot.jpg" />
  </div>
</div>

{% endblock %}
